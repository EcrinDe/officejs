<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>JIO</title>
  <script type="text/javascript" src="js/jquery/jquery.js"></script>
  <script type="text/javascript" src="unhosted/jio.js"></script>

  <script type="text/javascript" src="unhosted/jquery.storage.js"></script>  
  <script type="text/javascript" src="unhosted/base64.js"></script>
  <script type="text/javascript" src="unhosted/jio.storage.js"></script>
  <!-- <script type="text/javascript" src="unhosted/sjcl.js"></script> -->
</head>
<body>
  <!--  <div id="test" class="test">&lt;div1&gt;</div>
  <div id="test" class="test">&lt;div2&gt;</div> -->
  <div id="divbody">
    <div id="divmessage"></div>
    <div id="divdebug" style="color: grey"></div>
    <div id="diverror" style="color: red"></div>
  </div>
  <script type="text/javascript">
    <!--
////////////////////////////////////////////////////////////////////////////////
// little functions
var objectDump = function (o) {
    console.log (JSON.stringify(o));
};
var toString = function (o) {
    return JSON.stringify(o);
};
var is_array = function (v) {
    return Object.prototype.toString.apply(v) === '[object Array]';
};
////////////////////////////////////////////////////////////////////////////////
// Preparing jio
$.jio('subscribe',{'event':'job_done','func': function ( o ) {
    $('#divdebug').html($('#divdebug').html() + '<br />' +
                        toString(o));
}});
$.jio('subscribe',{'event':'job_fail','func': function ( o ) {
    $('#diverror').html($('#diverror').html() + '<br />' +
                        toString(o));
}});
$.jio('subscribe',{'event':'start_saving','func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Saving ...');
}});
$.jio('subscribe',{'event':'stop_saving','func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Saving ended.');    
}});
$.jio('subscribe',{'event':'start_loading','func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Loading ...');    
}});
$.jio('subscribe',{'event':'stop_loading','func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Loading ended.');    
}});
$.jio('subscribe',{'event':'start_checkingNameAvailability', 'func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Checking name ' + o.job.userName + ' ...');    
}});
$.jio('subscribe',{'event':'stop_checkingNameAvailability', 'func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Checking name ended: ' + o.job.message);
}});
$.jio('subscribe',{'event':'start_gettingList', 'func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Getting list ...');    
}});
$.jio('subscribe',{'event':'stop_gettingList', 'func': function ( o ) {
    $('#divmessage').html($('#divmessage').html() + '<br />' +
                          'Getting list ended: ' + toString(o) );
}});



$.jio({'storage':{'type':'local','userName':'tristan'},
       'applicant':{'ID':'www.ungproject.org'}});
// $.jio({'storage':{'type':'dav','userName':'tristan','password':'test',
//                   'location':'https://ca-davstorage:8080','provider':'Unknown'},
//        'applicant':{'ID':'www.ungproject.org'}});

// TODO
// doc string
// localStorage.status


// $.jio('isAvailable',{'userName':'toto'});
// $.jio('isAvailable',{'userName':'tristan'});
// $.jio('saveDocument',{'fileName':'SonNom','fileContent':'SonContenu'});
// $.jio({'fileName':'SonNom','fileContent':'SonContenu','method':'saveDocument'});
// $.jio({'fileName':'SonNom2','fileContent':'SonContenu2','method':'saveDocument'});
// $.jio('loadDocument',{'fileName':'SonNom'});
// $.jio('removeDocument',{'fileName':'SonNom'});
// $.jio('getDocumentList');
















////////////////////////////////////////////////////////////////////////////////
/*
// Preparing JIO
//// Setting events reactions
JIO.subscribe('job_done', function (job) {
    switch(job.method) {
    case 'load':
        objectDump(job);
        $('#divdebug').html($('#divdebug').html() + '<br />' +
                            job.method + ': "' + job.fileName + '" OK!' +
                            ' Content : "' + job.file.content + '"');
        break;
    case 'userNameAvailable':
        objectDump(job);
        $('#divdebug').html($('#divdebug').html() + '<br />' + 
                            job.method + ': "' + job.userName + '" OK!' +
                            ' isAvailable ? "' + job.userIsAvailable + '"' +
                            ' message : ' + job.message);
        break;
    default:
        objectDump(job);
        $('#divdebug').html($('#divdebug').html() + '<br />' +
                            job.method + ': "' + job.fileName + '" OK!');
        break;
    }
});
JIO.subscribe('job_fail', function (job) {
    $('#diverror').html($('#diverror').html() + '<br/>' +
                        job.method + ': "' + job.fileName + '" FAILED! ' +
                        job.message);
});
JIO.subscribe('start_saving', function () {
    console.log ('start_saving received');
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Saving ...');
    // $('#divdebug').html($('#divdebug').html() + '<br/>' +
    //                     'save remainingjobs: ' + o.remaining.save);
});
JIO.subscribe('stop_saving', function () {
    console.log ('stop_saving received');
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Saving ended.');
});
JIO.subscribe('start_loading', function () {
    console.log ('start_loading received');
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Loading ...');
});
JIO.subscribe('stop_loading', function () {
    console.log ('stop_loading received');
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Loading ended.');
});
// JIO.subscribe('start_deleting', function (e,o,r) {
//     console.log ('start_deleting received');
//     objectDump(o);
//     $('#divmessage').html($('#divmessage').html() + '<br/>' + 
//                           'Deleting "' + o.fileName + '"...');
//     $('#divdebug').html($('#divdebug').html() + '<br/>' +
//                         'delete remainingjobs: ' + r);
// });
// JIO.subscribe('stop_deleting', function (e,o) {
//     console.log ('stop_deleting received');
//     objectDump(o);
//     $('#divmessage').html($('#divmessage').html() + '<br/>' +
//                           'Deleting ended with result: ' + o.status + ', message: ' + o.message);
// });
// JIO.subscribe('start_gettinglist', function (e,o) {
//     console.log ('start_deleting received');
//     objectDump(o);
//     $('#divmessage').html($('#divmessage').html() + '<br/>' + 
//                           'Getting list...');
// });
// JIO.subscribe('stop_gettinglist', function (e,o) {
//     console.log ('stop_deleting received');
//     objectDump(o);
//     $('#divmessage').html($('#divmessage').html() + '<br/>' +
//                           'Getting list ended with result: ' + o.status + ', message: ' + o.message);
//     $('#divdebug').html($('#divdebug').html() + '<br/>' +
//                         'getList: ' + JSON.stringify(o.list));
// });
//// events set

//// init JIO
JIO.initialize({"type":"local","userName":"tristan"},"www.ungproject.com");
//// end init
//// Let's test!
if ( !JIO.isReady() ) alert('Not ready');
else {

    // JIO.userNameAvailable("tristan");
    // JIO.userNameAvailable("json");
    // JIO.loadDocument("SonNom");
    // JIO.saveDocument("Inside the document.","SonNom");
    // JIO.saveDocument("Inside the document.","SonNom");
    // JIO.saveDocument("Inside the document.","SonNom2");
    // JIO.getDocumentList();
    // JIO.loadDocument("SonNom");
    // JIO.deleteDocument("SonNom");
    // JIO.deleteDocument("SonNom");
    // JIO.deleteDocument("SonNom3");
    // JIO.getDocumentList();
}
////////////////////////////////////////////////////////////////////////////////
/* */
        //-->
  </script>
</body>
</html>
