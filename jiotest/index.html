<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>JIO</title>
  <script type="text/javascript" src="js/jquery/jquery.js"></script>
  <script type="text/javascript" src="unhosted/base64.js"></script>
  <script type="text/javascript" src="unhosted/sjcl.js"></script>
  <script type="text/javascript" src="unhosted/jio.js"></script>
</head>
<body>
  <div id="divbody">
    <div id="divmessage">
      
    </div>
    <div id="divdebug" style="color: grey">
      
    </div>
    <div id="diverror" style="color: red">
      
    </div>
  </div>
  <script type="text/javascript">
    <!--
////////////////////////////////////////////////////////////////////////////////
// little functions
var objectDump = function (o) {
    console.log (JSON.stringify(o));
};
var is_array = function (v) {
    return Object.prototype.toString.apply(v) === '[object Array]';
};
////////////////////////////////////////////////////////////////////////////////
// Preparing JIO
//// Setting events reactions
JIO.subscribe('start_saving', function (o) {
    console.log ('start_saving received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Saving ...');
    // $('#divdebug').html($('#divdebug').html() + '<br/>' +
    //                     'save remainingjobs: ' + o.remaining.save);
});
JIO.subscribe('stop_saving', function (o) {
    console.log ('stop_saving received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Saving ended.');
});
JIO.subscribe('start_loading', function (e,o,r) {
    console.log ('start_loading received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Loading "' + o.fileName + '"...');
    $('#divdebug').html($('#divdebug').html() + '<br/>' +
                        'load remainingjobs: ' + r);
});
JIO.subscribe('stop_loading', function (e,o) {
    console.log ('stop_loading received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Loading ended with result: ' + o.status + ', message: ' + o.message);
});
JIO.subscribe('start_deleting', function (e,o,r) {
    console.log ('start_deleting received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Deleting "' + o.fileName + '"...');
    $('#divdebug').html($('#divdebug').html() + '<br/>' +
                        'delete remainingjobs: ' + r);
});
JIO.subscribe('stop_deleting', function (e,o) {
    console.log ('stop_deleting received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' +
                          'Deleting ended with result: ' + o.status + ', message: ' + o.message);
});
JIO.subscribe('start_gettinglist', function (e,o) {
    console.log ('start_deleting received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' + 
                          'Getting list...');
});
JIO.subscribe('stop_gettinglist', function (e,o) {
    console.log ('stop_deleting received');
    objectDump(o);
    $('#divmessage').html($('#divmessage').html() + '<br/>' +
                          'Getting list ended with result: ' + o.status + ', message: ' + o.message);
    $('#divdebug').html($('#divdebug').html() + '<br/>' +
                        'getList: ' + JSON.stringify(o.list));
});
//// events set

//// init JIO
JIO.initialize({"type":"local","userName":"tristan"},"www.ungproject.com");
if ( !JIO.isReady() ) alert('Not ready');
//// end init

//// Let's test!
// JIO.loadDocument("SonNom");
JIO.saveDocument("Inside the document.","SonNom");
// JIO.saveDocument("Inside the document.","SonNom");
JIO.saveDocument("Inside the document.","SonNom2");
// JIO.getDocumentList();
// JIO.loadDocument("SonNom");
// JIO.deleteDocument("SonNom");
// JIO.deleteDocument("SonNom");
// JIO.deleteDocument("SonNom3");
// JIO.getDocumentList();
////////////////////////////////////////////////////////////////////////////////
        //-->
  </script>
</body>
</html>
