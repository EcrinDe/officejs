/*! JIO - v0.1.0 - 2012-10-12
* Copyright (c) 2012 Nexedi; Licensed  */
var jIO=function(){"use strict";var e=function(e,t){var n={};return e=e||{},t=t||{},n.name="jioException",n.message=e.message||"Unknown Reason.",n.toString=function(){return n.name+": "+n.message},n},t=function(t,n){var r=e(t,n);t=t||{};var i=t.command;return r.name="invalidCommandState",r.toString=function(){return r.name+": "+i.getLabel()+", "+r.message},r},n=function(t,n){var r=e(t,n);t=t||{};var i=t.storage.getType();return r.name="invalidStorage",r.toString=function(){return r.name+": "+'Type "'+i+'", '+r.message},r},r=function(t,n){var r=e(t,n),i=t.type;return r.name="invalidStorageType",r.toString=function(){return r.name+": "+i+", "+r.message},r},i=function(t,n){var r=e(t,n);return r.name="jobNotReadyException",r},s=function(t,n){var r=e(t,n);return r.name="tooMuchTriesJobException",r},o=function(t,n){var r=e(t,n);return r.name="invalidJobException",r},u=function(e){var t=function(e,t){var r={};e=e||{},t=t||{};var i={};return i.type=e.type||"",Object.defineProperty(r,"getType",{configurable:!1,enumerable:!1,writable:!1,value:function(){return i.type}}),r.execute=function(e){r.success=e.success,r.error=e.error,r.retry=e.retry,r.end=e.end,r.validate(e)&&e.executeOn(r)},r.isValid=function(){return!0},r.validate=function(){var e=r.validateState();return e?(r.error({status:0,statusText:"Invalid Storage",error:"invalid_storage",message:e,reason:e}),!1):!0},r.serialized=function(){return{type:r.getType()}},r.saveDocument=function(e){r.error({status:0,statusText:"Unknown storage",error:"unknown_storage",message:"Unknown Storage"})},r.loadDocument=function(e){r.saveDocument()},r.removeDocument=function(e){r.saveDocument()},r.getDocumentList=function(e){r.saveDocument()},r.validateState=function(){return""},r.success=function(){},r.retry=function(){},r.error=function(){},r.end=function(){},i.newCommand=function(e,r){var i=r||{};return i.label=e,n(i,t)},r.addJob=function(e,n,r,s,o,u){var a={options:s,callbacks:{success:o,error:u}};r&&(e==="get"?a.docid=r:a.doc=r),T.addJob(b({storage:t.storage(n||{}),command:i.newCommand(e,a)},t))},r},n=function(e,t){var r={};e=e||{},t=t||{};var i={};return i.commandlist={post:h,put:c,get:f,remove:l,allDocs:u},e.label&&i.commandlist[e.label]?(i.label=e.label,delete e.label,i.commandlist[i.label](e,t)):(i.tried=0,i.doc=e.doc||{},i.docid=e.docid||"",i.option=e.options||{},i.callbacks=e.callbacks||{},i.success=i.callbacks.success||function(){},i.error=i.callbacks.error||function(){},i.retry=function(){r.error({status:13,statusText:"Fail Retry",error:"fail_retry",message:"Impossible to retry.",reason:"Impossible to retry."})},i.end=function(){},i.on_going=!1,r.serialized=function(){return{label:r.getLabel(),tried:i.tried,doc:r.cloneDoc(),option:r.cloneOption()}},r.getLabel=function(){return"command"},r.getDocId=function(){return i.docid||i.doc._id},r.getDocContent=function(){return i.doc.content},r.getDocInfo=function(e){return i.doc[e]},r.getOption=function(e){return i.option[e]},r.validate=function(e){return r.validateState()?e.validate():!1},r.validateState=function(){return typeof i.doc!="object"?(r.error({status:20,statusText:"Document_Id Required",error:"document_id_required",message:"No document id.",reason:"no document id"}),!1):!0},r.canBeRetried=function(){return typeof i.option.max_retry=="undefined"||i.option.max_retry===0||i.tried<i.option.max_retry},r.getTried=function(){return i.tried},r.execute=function(e){i.on_going||r.validate(e)&&(i.tried++,i.on_going=!0,e.execute(r))},r.executeOn=function(e){},r.success=function(e){i.on_going=!1,i.success(e),i.end(d())},r.retry=function(e){i.on_going=!1,r.canBeRetried()?i.retry():r.error(e)},r.error=function(e){i.on_going=!1,i.error(e),i.end(v())},r.end=function(){i.end(d())},r.onSuccessDo=function(e){if(!e)return i.success;i.success=e},r.onErrorDo=function(e){if(!e)return i.error;i.error=e},r.onEndDo=function(e){i.end=e},r.onRetryDo=function(e){i.retry=e},r.canBeRestored=function(){return!0},r.clone=function(){return n(r.serialized(),t)},r.cloneOption=function(){var e,t={};for(e in i.option)t[e]=i.option[e];return t},r.cloneDoc=function(){if(i.docid)return i.docid;var e,t={};for(e in i.doc)t[e]=i.doc[e];return t},r)},u=function(e,t){var r=n(e,t);return e=e||{},t=t||{},r.getLabel=function(){return"allDocs"},r.executeOn=function(e){e.allDocs(r)},r.canBeRestored=function(){return!1},r.validateState=function(){return!0},r},f=function(e,t){var r=n(e,t);return e=e||{},t=t||{},r.getLabel=function(){return"get"},r.validateState=function(){return r.getDocId()?!0:(r.error({status:20,statusText:"Document Id Required",error:"document_id_required",message:"No document id.",reason:"no document id"}),!1)},r.executeOn=function(e){e.get(r)},r.canBeRestored=function(){return!1},r},l=function(e,t){var r=n(e,t);return e=e||{},t=t||{},r.getLabel=function(){return"remove"},r.executeOn=function(e){e.remove(r)},r},c=function(e,t){var r=n(e,t);e=e||{},t=t||{};var i={};return r.getLabel=function(){return"put"},r.validate=function(){return typeof r.getDocInfo("content")!="string"?(r.error({status:21,statusText:"Content Required",error:"content_required",message:"No data to put.",reason:"no data to put"}),!1):r.validateState()},r.executeOn=function(e){e.put(r)},r},h=function(e,t){var r=n(e,t);e=e||{},t=t||{};var i={};return r.getLabel=function(){return"post"},r.validate=function(){return typeof r.getDocInfo("content")!="string"?(r.error({status:21,statusText:"Content Required",error:"content_required",message:"No data to put.",reason:"no data to put"}),!1):r.validateState()},r.executeOn=function(e){e.put(r)},r},p=function(e,t){var n={};return e=e||{},t=t||{},n.getLabel=function(){return"job status"},n.canStart=function(){},n.canRestart=function(){},n.serialized=function(){return{label:n.getLabel()}},n.isWaitStatus=function(){return!1},n.isDone=function(){return!1},n},d=function(e,t){var n=p(e,t);return e=e||{},t=t||{},n.getLabel=function(){return"done"},n.canStart=function(){return!1},n.canRestart=function(){return!1},n.isDone=function(){return!0},n},v=function(e,t){var n=p(e,t);return e=e||{},t=t||{},n.getLabel=function(){return"fail"},n.canStart=function(){return!1},n.canRestart=function(){return!0},n},m=function(e,t){var n=p(e,t);return e=e||{},t=t||{},n.getLabel=function(){return"initial"},n.canStart=function(){return!0},n.canRestart=function(){return!0},n},g=function(e,t){var n=p(e,t);return e=e||{},t=t||{},n.getLabel=function(){return"on going"},n.canStart=function(){return!1},n.canRestart=function(){return!1},n},y=function(e,t){var n=p(e,t);e=e||{},t=t||{};var r={};return r.job_id_array=e.job_id_array||[],r.threshold=0,n.getLabel=function(){return"wait"},r.refreshJobIdArray=function(){var e=[],t;for(t=0;t<r.job_id_array.length;t+=1)T.jobIdExists(r.job_id_array[t])&&e.push(r.job_id_array[t]);r.job_id_array=e},n.waitForJob=function(e){var t;for(t=0;t<r.job_id_array.length;t+=1)if(r.job_id_array[t]===e.getId())return;r.job_id_array.push(e.getId())},n.dontWaitForJob=function(e){var t,n=[];for(t=0;t<r.job_id_array.length;t+=1)r.job_id_array[t]!==e.getId()&&n.push(r.job_id_array[t]);r.job_id_array=n},n.waitForTime=function(e){r.threshold=Date.now()+e},n.stopWaitForTime=function(){r.threshold=0},n.canStart=function(){return r.refreshJobIdArray(),r.job_id_array.length===0&&Date.now()>=r.threshold},n.canRestart=function(){return n.canStart()},n.serialized=function(){return{label:n.getLabel(),waitfortime:r.threshold,waitforjob:r.job_id_array}},n.isWaitStatus=function(){return!0},n},b=function(e){var t={};e=e||{};var n={};n.id=x.nextId(),n.command=e.command,n.storage=e.storage,n.status=m(),n.date=new Date;if(!n.storage)throw o({job:t,message:"No storage set"});if(!n.command)throw o({job:t,message:"No command set"});return t.getCommand=function(){return n.command},t.getStatus=function(){return n.status},t.getId=function(){return n.id},t.getStorage=function(){return n.storage},t.getDate=function(){return n.date},t.isReady=function(){return n.command.getTried()===0?n.status.canStart():n.status.canRestart()},t.serialized=function(){return{id:n.id,date:n.date.getTime(),status:n.status.serialized(),command:n.command.serialized(),storage:n.storage.serialized()}},t.waitForJob=function(e){n.status.getLabel()!=="wait"&&(n.status=y({})),n.status.waitForJob(e)},t.dontWaitFor=function(e){n.status.getLabel()==="wait"&&n.status.dontWaitForJob(e)},t.waitForTime=function(e){n.status.getLabel()!=="wait"&&(n.status=y({})),n.status.waitForTime(e)},t.stopWaitForTime=function(){n.status.getLabel()==="wait"&&n.status.stopWaitForTime()},t.eliminated=function(){n.command.error({status:10,statusText:"Stopped",error:"stopped",message:"This job has been stopped by another one.",reason:"this job has been stopped by another one"})},t.notAccepted=function(){n.command.onEndDo(function(){n.status=v(),T.terminateJob(t)}),n.command.error({status:11,statusText:"Not Accepted",error:"not_accepted",message:"This job is already running.",reason:"this job is already running"})},t.update=function(e){n.command.error({status:12,statusText:"Replaced",error:"replaced",message:"Job has been replaced by another one.",reason:"job has been replaced by another one"}),n.date=new Date(e.getDate().getTime()),n.command=e.getCommand(),n.status=e.getStatus()},t.execute=function(){if(!t.getCommand().canBeRetried())throw s({job:t,message:"The job was invoked too much time."});if(!t.isReady())throw i({job:t,message:"Can not execute this job."});n.status=g(),n.command.onRetryDo(function(){var e=n.command.getTried();e=e*e*200,e>1e4&&(e=1e4),t.waitForTime(e)}),n.command.onEndDo(function(e){n.status=e,T.terminateJob(t)}),n.command.execute(n.storage)},t},w=function(e,t){var n={};e=e||{},t=t||{};var r=[],i=e.name||"",s=e.announcer||{};return n.add=function(e){r.push(e)},n.remove=function(e){var t,n=[];for(t=0;t<r.length;t+=1)r[t]!==e&&n.push(r[t]);r=n},n.register=function(){s.register(n)},n.unregister=function(){s.unregister(n)},n.trigger=function(e){var t;for(t=0;t<r.length;t++)r[t].apply(null,e)},n},E=function(e,t){var n={};e=e||{},t=t||{};var r={};return r.id=e.id||0,r.interval=400,r.interval_id=null,r.touch=function(){LocalOrCookieStorage.setItem("jio/id/"+r.id,Date.now())},n.setId=function(e){r.id=e},n.setIntervalDelay=function(e){r.interval=e},n.getIntervalDelay=function(){return r.interval},n.start=function(){r.interval_id||(r.touch(),r.interval_id=setInterval(function(){r.touch()},r.interval))},n.stop=function(){r.interval_id!==null&&(clearInterval(r.interval_id),r.interval_id=null)},n}(),S=function(e,t){var n={};e=e||{},t=t||{};var r={};return n.register=function(e){r[e]||(r[e]=w())},n.unregister=function(e){r[e]&&delete r[e]},n.at=function(e){return r[e]},n.on=function(e,t){n.register(e),n.at(e).add(t)},n.trigger=function(e,t){n.at(e).trigger(t)},n}(),x=function(e){var t={};e=e||{};var n=0;return t.nextId=function(){return n+=1,n},t}(),T=function(e){var t={};e=e||{};var r="jio/job_array",i={};return i.id=e.id,i.interval_id=null,i.interval=200,i.job_array=[],i.getJobArrayName=function(){return r+"/"+i.id},i.getJobArray=function(){return LocalOrCookieStorage.getItem(i.getJobArrayName())||[]},i.copyJobArrayToLocal=function(){var e=[],t;for(t=0;t<i.job_array.length;t+=1)e.push(i.job_array[t].serialized());LocalOrCookieStorage.setItem(i.getJobArrayName(),e)},i.removeJob=function(e){var t,n=[];for(t=0;t<i.job_array.length;t+=1)i.job_array[t]!==e&&n.push(i.job_array[t]);i.job_array=n,i.copyJobArrayToLocal()},t.setId=function(e){i.id=e},t.start=function(){var e;i.interval_id===null&&(i.interval_id=setInterval(function(){i.restoreOldJio();for(e=0;e<i.job_array.length;e+=1)t.execute(i.job_array[e])},i.interval))},t.stop=function(){i.interval_id!==null&&(clearInterval(i.interval_id),i.interval_id=null,i.job_array.length===0&&LocalOrCookieStorage.deleteItem(i.getJobArrayName()))},i.restoreOldJio=function(){var e,t;i.lastrestore=i.lastrestore||0;if(i.lastrestore>Date.now()-2e3)return;t=LocalOrCookieStorage.getItem("jio/id_array")||[];for(e=0;e<t.length;e+=1)i.restoreOldJioId(t[e]);i.lastrestore=Date.now()},i.restoreOldJioId=function(e){var t;t=LocalOrCookieStorage.getItem("jio/id/"+e)||0,(new Date(t)).getTime()<Date.now()-1e4&&(i.restoreOldJobFromJioId(e),i.removeOldJioId(e),i.removeJobArrayFromJioId(e))},i.restoreOldJobFromJioId=function(e){var r,i;i=LocalOrCookieStorage.getItem("jio/job_array/"+e)||[];for(r=0;r<i.length;r+=1){var s=n(i[r].command);s.canBeRestored()&&t.addJob(b({storage:t.storage(i[r].storage),command:s}))}},i.removeOldJioId=function(e){var t,n,r=[];n=LocalOrCookieStorage.getItem("jio/id_array")||[];for(t=0;t<n.length;t+=1)n[t]!==e&&r.push(n[t]);LocalOrCookieStorage.setItem("jio/id_array",r),LocalOrCookieStorage.deleteItem("jio/id/"+e)},i.removeJobArrayFromJioId=function(e){LocalOrCookieStorage.deleteItem("jio/job_array/"+e)},t.execute=function(e){try{e.execute()}catch(t){switch(t.name){case"jobNotReadyException":break;case"tooMuchTriesJobException":break;default:throw t}}i.copyJobArrayToLocal()},t.jobIdExists=function(e){var t;for(t=0;t<i.job_array.length;t+=1)if(i.job_array[t].getId()===e)return!0;return!1},t.terminateJob=function(e){i.removeJob(e)},t.addJob=function(e){var n=t.validateJobAccordingToJobList(i.job_array,e);i.appendJob(e,n)},t.validateJobAccordingToJobList=function(e,t){var n,r=[];for(n=0;n<e.length;n+=1)r.push(N.validateJobAccordingToJob(e[n],t));return r},i.appendJob=function(e,t){var n;if(i.job_array.length!==t.length)throw new RangeError("Array out of bound");for(n=0;n<t.length;n+=1)if(t[n].action==="dont accept")return e.notAccepted();for(n=0;n<t.length;n+=1)switch(t[n].action){case"eliminate":t[n].job.eliminated(),i.removeJob(t[n].job);break;case"update":t[n].job.update(e),i.copyJobArrayToLocal();return;case"wait":e.waitForJob(t[n].job);break;default:}i.job_array.push(e),i.copyJobArrayToLocal()},t.serialized=function(){var e=[],t,n=i.job_array||[];for(t=0;t<n.length;t+=1)e.push(n[t].serialized());return e},t}(),N=function(e){var t={},n={};n.compare={},n.action={},Object.defineProperty(t,"eliminate",{configurable:!1,enumerable:!1,writable:!1,value:function(){return"eliminate"}}),Object.defineProperty(t,"update",{configurable:!1,enumerable:!1,writable:!1,value:function(){return"update"}}),Object.defineProperty(t,"dontAccept",{configurable:!1,enumerable:!1,writable:!1,value:function(){return"dont accept"}}),Object.defineProperty(t,"wait",{configurable:!1,enumerable:!1,writable:!1,value:function(){return"wait"}}),Object.defineProperty(t,"none",{configurable:!1,enumerable:!1,writable:!1,value:function(){return"none"}}),t.default_action=t.none,t.default_compare=function(e,t){return e.getCommand().getDocId()===t.getCommand().getDocId()&&e.getCommand().getDocInfo("_rev")===t.getCommand().getDocInfo("_rev")&&e.getCommand().getOption("rev")===t.getCommand().getOption("rev")&&JSON.stringify(e.getStorage().serialized())===JSON.stringify(t.getStorage().serialized())},n.getAction=function(e,r){var i,s,o;return i=e.getCommand().getLabel(),s=r.getCommand().getLabel(),o=e.getStatus().getLabel()==="on going"?"on going":"not on going",n.action[i]&&n.action[i][o]&&n.action[i][o][s]?n.action[i][o][s](e,r):t.default_action(e,r)},n.canCompare=function(e,r){var i=e.getCommand().getLabel(),s=r.getCommand().getLabel();return n.compare[i]&&n.compare[s]?n.compare[i][s](e,r):t.default_compare(e,r)},Object.defineProperty(t,"validateJobAccordingToJob",{configurable:!1,enumerable:!1,writable:!1,value:function(e,r){return n.canCompare(e,r)?{action:n.getAction(e,r),job:e}:{action:t.default_action(e,r),job:e}}}),Object.defineProperty(t,"addActionRule",{configurable:!1,enumerable:!1,writable:!1,value:function(e,t,r,i){var s=t?"on going":"not on going";n.action[e]=n.action[e]||{},n.action[e][s]=n.action[e][s]||{},n.action[e][s][r]=i}}),Object.defineProperty(t,"addCompareRule",{configurable:!1,enumerable:!1,writable:!1,value:function(e,t,r){n.compare[e]=n.compare[e]||{},n.compare[e][t]=r}});var r=function(e,n){return e.getCommand().getDocInfo("content")===n.getCommand().getDocInfo("content")?t.dontAccept():t.wait()};return t.addActionRule("post",!0,"post",r),t.addActionRule("post",!0,"put",r),t.addActionRule("post",!0,"get",t.wait),t.addActionRule("post",!0,"remove",t.wait),t.addActionRule("post",!1,"post",t.update),t.addActionRule("post",!1,"put",t.update),t.addActionRule("post",!1,"get",t.wait),t.addActionRule("post",!1,"remove",t.eliminate),t.addActionRule("put",!0,"post",r),t.addActionRule("put",!0,"put",r),t.addActionRule("put",!0,"get",t.wait),t.addActionRule("put",!0,"remove",t.wait),t.addActionRule("put",!1,"post",t.update),t.addActionRule("put",!1,"put",t.update),t.addActionRule("put",!1,"get",t.wait),t.addActionRule("put",!1,"remove",t.eliminate),t.addActionRule("get",!0,"post",t.wait),t.addActionRule("get",!0,"put",t.wait),t.addActionRule("get",!0,"get",t.dontAccept),t.addActionRule("get",!0,"remove",t.wait),t.addActionRule("get",!1,"post",t.wait),t.addActionRule("get",!1,"put",t.wait),t.addActionRule("get",!1,"get",t.update),t.addActionRule("get",!1,"remove",t.wait),t.addActionRule("remove",!0,"get",t.dontAccept),t.addActionRule("remove",!0,"remove",t.dontAccept),t.addActionRule("remove",!1,"post",t.eliminate),t.addActionRule("remove",!1,"put",t.eliminate),t.addActionRule("remove",!1,"get",t.dontAccept),t.addActionRule("remove",!1,"remove",t.update),t.addActionRule("allDocs",!0,"allDocs",t.dontAccept),t.addActionRule("allDocs",!1,"allDocs",t.update),t}(),C={},k={};e=e||{};var L="jio/id_array";return k.id=null,k.storage_spec=e,k.init=function(){if(k.id===null){var e,t=LocalOrCookieStorage.getItem(L)||[];k.id=1;for(e=0;e<t.length;e+=1)t[e]>=k.id&&(k.id=t[e]+1);t.push(k.id),LocalOrCookieStorage.setItem(L,t),E.setId(k.id),T.setId(k.id)}},Object.defineProperty(C,"storage",{configurable:!1,enumerable:!1,writable:!1,value:function(e,n,i){e=e||{},n=n||{},n.basicStorage=t,n.storage=C.storage;var s=i||e.type||"base";if(s==="base")return t(e,n);if(!a[s])throw r({type:s,message:"Storage does not exists."});return a[s](e,n)}}),T.storage=C.storage,Object.defineProperty(C,"start",{configurable:!1,enumerable:!1,writable:!1,value:function(){k.init(),E.start(),T.start()}}),Object.defineProperty(C,"stop",{configurable:!1,enumerable:!1,writable:!1,value:function(){T.stop()}}),Object.defineProperty(C,"close",{configurable:!1,enumerable:!1,writable:!1,value:function(){E.stop(),T.stop(),k.id=null}}),Object.defineProperty(C,"getId",{configurable:!1,enumerable:!1,writable:!1,value:function(){return k.id}}),Object.defineProperty(C,"getJobRules",{configurable:!1,enumerable:!1,writable:!1,value:function(){return N}}),Object.defineProperty(C,"validateStorageDescription",{configurable:!1,enumerable:!1,writable:!1,value:function(e){return C.storage(e).isValid()}}),Object.defineProperty(C,"getJobArray",{configurable:!1,enumerable:!1,writable:!1,value:function(){return T.serialized()}}),k.getParam=function(e,t){var n={},r=0;return t||(n.doc=e[r],r++),typeof e[r]=="object"?(n.options=e[r],r++):n.options={},n.callback=function(e,t){},n.success=function(e){n.callback(undefined,e)},n.error=function(e){n.callback(e,undefined)},typeof e[r]=="function"&&(typeof e[r+1]=="function"?(n.success=e[r],n.error=e[r+1]):n.callback=e[r]),n},k.addJob=function(e,t){T.addJob(b({storage:C.storage(k.storage_spec),command:e(t)}))},Object.defineProperty(C,"post",{configurable:!1,enumerable:!1,writable:!1,value:function(){var e=k.getParam(arguments);e.options.max_retry=e.options.max_retry||0,k.addJob(h,{doc:e.doc,options:e.options,callbacks:{success:e.success,error:e.error}})}}),Object.defineProperty(C,"put",{configurable:!1,enumerable:!1,writable:!1,value:function(){var e=k.getParam(arguments);e.options.max_retry=e.options.max_retry||0,k.addJob(c,{doc:e.doc,options:e.options,callbacks:{success:e.success,error:e.error}})}}),Object.defineProperty(C,"get",{configurable:!1,enumerable:!1,writable:!1,value:function(){var e=k.getParam(arguments);e.options.max_retry=e.options.max_retry||3,e.options.metadata_only=e.options.metadata_only!==undefined?e.options.metadata_only:!1,k.addJob(f,{docid:e.doc,options:e.options,callbacks:{success:e.success,error:e.error}})}}),Object.defineProperty(C,"remove",{configurable:!1,enumerable:!1,writable:!1,value:function(){var e=k.getParam(arguments);e.options.max_retry=e.options.max_retry||0,k.addJob(l,{doc:e.doc,options:e.options,callbacks:{success:e.success,error:e.error}})}}),Object.defineProperty(C,"allDocs",{configurable:!1,enumerable:!1,writable:!1,value:function(){var e=k.getParam(arguments,"no doc");e.options.max_retry=e.options.max_retry||3,e.options.metadata_only=e.options.metadata_only!==undefined?e.options.metadata_only:!0,k.addJob(u,{options:e.options,callbacks:{success:e.success,error:e.error}})}}),C},a={base:function(){}},f=function(e){var t={};return e=e||{},Object.defineProperty(t,"newJio",{configurable:!1,enumerable:!1,writable:!1,value:function(e){var t=e,n=null;return typeof t=="string"&&(t=JSON.parse(t)),t=t||{type:"base"},n=u(e),n.start(),n}}),Object.defineProperty(t,"addStorageType",{configurable:!1,enumerable:!1,writable:!1,value:function(e,t){t=t||function(){return null};if(a[e])throw r({type:e,message:"Already known."});a[e]=t}}),t}();return f}();